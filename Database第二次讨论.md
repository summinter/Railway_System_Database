# Database第二次讨论

## Index（索引）（难度：中等）

定义：单独存储在磁盘上的数据库结构，包含着对数据表里所有记录的引用指针

优点：

1. 通过创建唯一索引，可以保证table中每一row的唯一性
2. 可以极大提高查询速度
3. 可以加速表与表之间连接
4. 显著减少查询时分组和排序的时间

缺点：

1. 创建和维护索引需要耗时
2. 索引需要额外占用磁盘空间
3. 增、删、改数据时需动态维护索引，拉慢速度

分类：

1. B-tree（适合有序数据）
2. Hash（只能处理简单=比较）
3. GiST（还没看懂）
4. GIN（与GiST类似？）

## View（视图）（难度：简单）

定义：从真实表中导出的虚拟表，很像真实的表。

作用：

1. 简单化（只放需要的数据，排除复杂无用数据的干扰）
2. 安全性（用户只能查看、修改视图中的数据）
3. 独立性（屏蔽真实表局部变化带来的影响）

## High Concurrency（高并发）（难度：未知）

定义：多用户对同一个数据库进行修改时会产生并发问题，而并发控制的目标就是保证所有的会话可以同时高效地访问，并且还需要维护数据的完整性。

并发问题：

1. 脏读

   当一个事务读取记录，另一个事务还没完成对该部分记录的编辑时，产生脏读。

2. 幻读

   当某一row被update或insert或delete时，某个事务对其进行读取，产生幻读。

3. 不可重复性读取

   一个事务多次读取相同记录，但中间某刻记录被修改，导致前后读取结果不同。

解决方案：隔离、锁

| 隔离级别 | 脏读   | 幻读   | 不可重复性读取 |
| -------- | ------ | ------ | -------------- |
| 读未提交 | 可能   | 可能   | 可能           |
| 读已提交 | 不可能 | 可能   | 可能           |
| 可重复读 | 不可能 | 可能   | 不可能         |
| 可串行读 | 不可能 | 不可能 | 不可能         |

（PostgreSQL 支持 读已提交 和 可串行读 两种隔离级别）

## Procedure 过程 （难度：简单）
过程与函数类似，都是在为了开发的方便在数据库中创建并且调用的sql语句
优点:允许多个应用访问这些过程；
	允许当业务规则发生变化时进行单个点的改变，而不必改变应用系统的其他部分
	应用代码可以调用存储过程，而不是直接更新数据库关系

使用方法：create procedure proc (in a integer, out b varchar(20))
		   begin
		    (sub query)
		   end
		   declare b varchar(20)
		   call proc(6)


同时SQL支持用一种程序设计语言定义函数和外部过程



## Trigger 触发器 （难度：中等）
触发器是一条语句，当对数据库作修改时，它自动被系统执行
要设置触发器，必须满足两个条件
1.指明什么条件下执行触发器
2.指明触发器执行时的动作

触发器可被用来维持某些完整性约束


## Connection Pool 连接池(难度：困难?)

最原始的数据库使用就是打开一个连接并进行使用，使用过后一定要关闭连接释放资源。由于频繁的打开和关闭连接对jvm包括数据库
都有一定的资源负荷，尤其应用压力较大时资源占用比较多容易产生性能问题。由此使用连接池的作用就显现出来，他的原理其实不复杂：
先打开一定数量的数据库连接，当使用的时候分配给调用者，调用完毕后返回给连接池，注意返回给连接池后这些连接并不会关闭，而是
准备给下一个调用者进行分配。由此可以看出连接池节省了大量的数据库连接打开和关闭的动作，对系统性能提升的益处不言而喻。

Java中建议使用的数据库连接池: C3P0（稳定性高）,DBCP（配置方便）
